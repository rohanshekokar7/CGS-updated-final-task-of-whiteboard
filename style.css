/* CSS Variables for Theming */
:root {
    --bg-color: #f4f7fa;
    --container-bg: #ffffff;
    --toolbar-bg: #fdfdfd;
    --text-color: #2d3748;
    --text-color-light: #718096;
    --border-color: #e2e8f0;
    --button-bg: #ffffff;
    --button-border: #cbd5e0;
    --button-hover-bg: #f7fafc;
    --button-hover-border: #a0aec0;
    --button-active-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --button-active-border: #667eea;
    --button-active-color: #ffffff;
    --canvas-bg: #ffffff;
    --input-bg: #ffffff;
    --shadow-color: rgba(0, 0, 0, 0.05);
    --gradient-start: #667eea;
    --gradient-end: #764ba2;
}

body.dark-mode {
    --bg-color: #1a202c;
    --container-bg: #2d3748;
    --toolbar-bg: #283141;
    --text-color: #e2e8f0;
    --text-color-light: #a0aec0;
    --border-color: #4a5568;
    --button-bg: #4a5568;
    --button-border: #718096;
    --button-hover-bg: #2d3748;
    --button-hover-border: #a0aec0;
    --button-active-bg: linear-gradient(135deg, #5a67d8 0%, #805ad5 100%);
    --button-active-border: #5a67d8;
    --button-active-color: #ffffff;
    --canvas-bg: #1A202C;
    --input-bg: #4a5568;
    --shadow-color: rgba(0, 0, 0, 0.2);
    --gradient-start: #5a67d8;
    --gradient-end: #805ad5;
}

/* Basic Reset and Body Styling */
body {
    font-family: 'Inter', sans-serif;
    background-image: linear-gradient(120deg, var(--bg-color) 0%, #eef2f7 100%);
    color: var(--text-color);
    margin: 0;
    padding: 20px;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 100vh;
    box-sizing: border-box;
    transition: background-color 0.3s, color 0.3s;
}

body.dark-mode {
     background-image: linear-gradient(120deg, var(--bg-color) 0%, #2d3748 100%);
}

.app-wrapper {
    display: flex;
    gap: 20px;
    width: 100%;
    max-width: 1200px;
    align-items: flex-start;
}

/* Main Application Container */
.whiteboard-container {
    flex-grow: 1;
    background-color: var(--container-bg);
    border-radius: 16px;
    box-shadow: 0 20px 40px var(--shadow-color);
    border: 1px solid var(--border-color);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    transition: all 0.3s ease;
}

/* Toolbar Styling */
.toolbar {
    padding: 12px 20px;
    background-color: var(--toolbar-bg);
    border-bottom: 1px solid var(--border-color);
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 15px;
    transition: background-color 0.3s, border-bottom-color 0.3s;
}

/* Styling for each tool group */
.tool-group {
    display: flex;
    align-items: center;
    gap: 10px;
    border-right: 1px solid var(--border-color);
    padding-right: 15px;
}
.tool-group:last-child { border-right: none; padding-right: 0; }

.tool-group label { font-size: 14px; font-weight: 500; color: var(--text-color-light); }

.tool-button, .action-button, select {
    padding: 8px 12px; font-size: 14px; font-weight: 500; border: 1px solid var(--button-border);
    border-radius: 8px; background-color: var(--button-bg); color: var(--text-color);
    cursor: pointer; transition: all 0.2s ease-in-out; display: flex; align-items: center; gap: 6px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}

select { background-color: var(--input-bg); }
.tool-button:disabled, .action-button:disabled { opacity: 0.5; cursor: not-allowed; box-shadow: none; transform: none; }
.tool-button:hover:not(:disabled), .action-button:hover:not(:disabled), select:hover { background-color: var(--button-hover-bg); border-color: var(--button-hover-border); transform: translateY(-1px); box-shadow: 0 4px 8px rgba(0,0,0,0.07); }
.tool-button.active { 
    background: var(--button-active-bg);
    color: var(--button-active-color); 
    border-color: var(--button-active-border);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    transform: translateY(-2px);
}

input[type="color"] { -webkit-appearance: none; width: 36px; height: 36px; border: 1px solid var(--border-color); padding: 0; border-radius: 50%; cursor: pointer; overflow: hidden; transition: transform 0.2s; }
input[type="color"]:hover { transform: scale(1.1); }
input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
input[type="color"]::-webkit-color-swatch { border: none; border-radius: 50%; }
input[type="range"] { cursor: pointer; width: 100px; }

#theme-toggle svg { display: none; }
body:not(.dark-mode) #theme-icon-light { display: block; }
body.dark-mode #theme-icon-dark { display: block; }

/* Canvas styling */
.canvas-wrapper { position: relative; }
canvas {
    cursor: crosshair; /* Default for shapes */
    display: block; background-color: var(--canvas-bg);
    transition: background-color 0.3s;
    touch-action: none; /* Prevents default touch behaviors like scrolling */
}

/* Custom Cursors for Tools */
body:not(.dark-mode) .cursor-pencil { cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23333' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z'></path></svg>") 4 20, auto; }
body.dark-mode .cursor-pencil { cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23f1f1f1' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z'></path></svg>") 4 20, auto; }
body:not(.dark-mode) .cursor-ink-pen { cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23333' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='m17.5 2.5-15 15L6 21.5l15-15-3.5-4Z'/><path d='m14.5 5.5 3 3'/><path d='M5 19l-2.5 2.5'/></svg>") 4 20, auto; }
body.dark-mode .cursor-ink-pen { cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23f1f1f1' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='m17.5 2.5-15 15L6 21.5l15-15-3.5-4Z'/><path d='m14.5 5.5 3 3'/><path d='M5 19l-2.5 2.5'/></svg>") 4 20, auto; }
body:not(.dark-mode) .cursor-eraser { cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23333' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21H7z'/><path d='M18 7.5l-4.5 4.5'/></svg>") 4 20, auto; }
body.dark-mode .cursor-eraser { cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23f1f1f1' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21H7z'/><path d='M18 7.5l-4.5 4.5'/></svg>") 4 20, auto; }

/* Layers Panel Styling */
#layers-panel {
    width: 220px;
    flex-shrink: 0;
    background-color: var(--container-bg);
    border-radius: 16px;
    box-shadow: 0 20px 40px var(--shadow-color);
    border: 1px solid var(--border-color);
    padding: 15px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    transition: all 0.3s ease;
}
#layers-panel h3 { margin: 0 0 10px 0; font-size: 16px; border-bottom: 1px solid var(--border-color); padding-bottom: 10px;}
#layers-list { list-style: none; margin: 0; padding: 0; flex-grow: 1; }
.layer-item { display: flex; align-items: center; gap: 8px; padding: 10px; border-radius: 8px; cursor: pointer; transition: background-color 0.2s, transform 0.2s; }
.layer-item:hover { background-color: var(--button-hover-bg); transform: translateX(3px); }
.layer-item.active { background: var(--button-active-bg); color: var(--button-active-color); }
.layer-name { flex-grow: 1; font-weight: 500;}
.layer-visibility, .delete-layer-btn { background: none; border: none; padding: 4px; cursor: pointer; color: var(--text-color-light); transition: color 0.2s; }
.layer-item.active .layer-visibility, .layer-item.active .delete-layer-btn { color: var(--button-active-color); }
.layer-visibility:hover, .delete-layer-btn:hover { color: var(--gradient-start); }
.layer-item.active .layer-visibility:hover, .layer-item.active .delete-layer-btn:hover { color: rgba(255,255,255,0.8); }
#layers-controls { display: flex; gap: 10px; border-top: 1px solid var(--border-color); padding-top: 10px; }
#add-layer-btn { width: 100%; }

/* --- RESPONSIVENESS --- */
@media (max-width: 1200px) {
    .app-wrapper {
        flex-direction: column;
        width: 100%;
    }
    #layers-panel {
        width: 100%;
        box-sizing: border-box;
        order: 3; /* Move layers panel to the bottom */
    }
    .whiteboard-container {
        width: 100%;
    }
}

@media (max-width: 768px) {
    body {
        padding: 10px;
    }
    .toolbar {
        padding: 10px;
        gap: 10px;
    }
    .tool-group {
        padding-right: 10px;
        gap: 8px;
    }
    /* Hide labels on smaller tablets to save space */
    .tool-group label {
        display: none;
    }
}

@media (max-width: 480px) {
    body {
        padding: 5px;
    }
    .toolbar {
        padding: 8px;
        justify-content: center; /* Center the tool groups */
    }
    .tool-group {
        border-right: none; /* Remove all dividers */
        padding-right: 0;
    }
    /* Make the stroke preview smaller */
    #stroke-preview {
        width: 40px;
        height: 40px;
    }
    input[type="range"] {
        width: 70px; /* Further reduce slider width */
    }
    /* Adjust padding for smaller tap targets */
    .tool-button, .action-button, select {
        padding: 8px;
    }
}